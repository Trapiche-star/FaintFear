using UnityEngine;

namespace FaintFear
{
    /// <summary>
    /// ìŠ¤íƒ€íŠ¸ íŠ¸ë¦¬ê±° ë‚´ë¶€ í¬ì¸íŠ¸ ë¼ì´íŠ¸ ì¡°ì ˆ (ì´ˆê¸° í”„ë ˆì„ ì•ˆì „ì²˜ë¦¬ í¬í•¨)
    /// </summary>
    public class LightZone01 : MonoBehaviour
    {
        [Header("ê±´ë¬¼ ë‚´ë¶€ ëª¨ë“  Point Lightê°€ ë“¤ì–´ìˆëŠ” ë¶€ëª¨ ì˜¤ë¸Œì íŠ¸")]
        public GameObject allPointLights; // AllPointLight ì˜¤ë¸Œì íŠ¸ë¥¼ ë“œë˜ê·¸í•´ì„œ ì—°ê²°

        [Header("íŠ¸ë¦¬ê±° ì•ˆì¼ ë•Œ ë¹›ì´ ë‹¿ëŠ” ìµœëŒ€ ë²”ìœ„ (Range)")]
        public float activeRange = 8f; // ë¼ì´íŠ¸ê°€ ì¼œì¡Œì„ ë•Œ Range ê°’

        [Header("íŠ¸ë¦¬ê±° ë°–ì¼ ë•Œ Range (ë¹›ì´ ì•ˆ í¼ì§€ê²Œ 0ìœ¼ë¡œ ë‘ë©´ ë¨)")]
        public float inactiveRange = 0f; // ë¼ì´íŠ¸ê°€ êº¼ì¡Œì„ ë•Œ Range ê°’

        [Header("ë¼ì´íŠ¸ê°€ ì¼œì§ˆ ìˆ˜ ìˆëŠ” ìµœëŒ€ ê±°ë¦¬ (íŠ¸ë¦¬ê±° ì¤‘ì‹¬ ê¸°ì¤€)")]
        public float triggerLightDistance = 15f; // íŠ¸ë¦¬ê±° ì¤‘ì‹¬ìœ¼ë¡œë¶€í„° ì¼ì • ê±°ë¦¬ ì•ˆì˜ ë¼ì´íŠ¸ë§Œ ì¼œì§

        // AllPointLight ìì‹ì— ìˆëŠ” Light ì»´í¬ë„ŒíŠ¸ë¥¼ ë‹´ì„ ë°°ì—´
        private Light[] lights;

        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // ğŸ”¸ Awake(): ì”¬ì´ ë¡œë“œë˜ìë§ˆì ê°€ì¥ ë¨¼ì € ì‹¤í–‰ë¨ (Start()ë³´ë‹¤ ë¹ ë¦„)
        //              â†’ ì²« í”„ë ˆì„ì—ì„œ ë¶ˆí•„ìš”í•œ ë¼ì´íŠ¸ ì—°ì‚° ë°©ì§€ìš© ì´ˆê¸°í™”
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        void Awake()
        {
            if (allPointLights != null)
                lights = allPointLights.GetComponentsInChildren<Light>();

            SetLightsActive(false); // ì‹œì‘ ì‹œ ëª¨ë“  ë¼ì´íŠ¸ êº¼ë‘ê¸°
        }

        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // ğŸ”¸ Start(): íŠ¸ë¦¬ê±° ì•ˆì— Playerê°€ ìˆëŠ”ì§€ ì´ˆê¸° ìƒíƒœ í™•ì¸
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        void Start()
        {
            if (lights == null) return; // ë¼ì´íŠ¸ê°€ ì—†ìœ¼ë©´ ì¤‘ë‹¨

            // íŠ¸ë¦¬ê±° ì½œë¼ì´ë” ì˜ì—­ ì•ˆì— Playerê°€ ì´ë¯¸ ìˆëŠ”ì§€ ê²€ì‚¬
            Collider[] colliders = Physics.OverlapBox(
                transform.position,
                GetComponent<BoxCollider>().size / 2,
                transform.rotation
            );

            foreach (Collider col in colliders)
            {
                if (col.CompareTag("Player"))
                {
                    SetLightsActive(true); // ì´ë¯¸ ì•ˆì— ìˆìœ¼ë©´ ë¼ì´íŠ¸ ì¼œê¸°
                    return; // ë” ì´ìƒ ê²€ì‚¬ ë¶ˆí•„ìš”
                }
            }

            SetLightsActive(false); // Playerê°€ ì—†ìœ¼ë©´ êº¼ë‘ê¸°
        }

        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // ğŸ”¸ Playerê°€ íŠ¸ë¦¬ê±° ì•ˆìœ¼ë¡œ ë“¤ì–´ì™”ì„ ë•Œ
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        private void OnTriggerEnter(Collider other)
        {
            if (other.CompareTag("Player"))
                SetLightsActive(true); // Player ì§„ì… â†’ ë¼ì´íŠ¸ ì¼œê¸°
        }

        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // ğŸ”¸ Playerê°€ íŠ¸ë¦¬ê±° ë°–ìœ¼ë¡œ ë‚˜ê°”ì„ ë•Œ
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        private void OnTriggerExit(Collider other)
        {
            if (other.CompareTag("Player"))
                SetLightsActive(false); // Player ì´íƒˆ â†’ ë¼ì´íŠ¸ ë„ê¸°
        }

        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // ğŸ”¸ ë¼ì´íŠ¸ ìƒíƒœë¥¼ ì¼ê´„ë¡œ ë³€ê²½í•˜ëŠ” í•¨ìˆ˜
        //      state = true â†’ ì¼œê¸° / false â†’ ë„ê¸°
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        public void SetLightsActive(bool state)
        {
            if (lights == null) return; // ë°°ì—´ì´ ë¹„ì–´ìˆìœ¼ë©´ ì¤‘ë‹¨

            Vector3 triggerCenter = transform.position; // íŠ¸ë¦¬ê±° ì¤‘ì‹¬ ê¸°ì¤€ ì¢Œí‘œ

            foreach (Light l in lights)
            {
                float distance = Vector3.Distance(l.transform.position, triggerCenter); // íŠ¸ë¦¬ê±° ì¤‘ì‹¬ê³¼ ë¼ì´íŠ¸ ê°„ ê±°ë¦¬ ê³„ì‚°

                if (state && distance <= triggerLightDistance)
                {
                    // íŠ¸ë¦¬ê±° ì•ˆ + ê±°ë¦¬ ì•ˆ â†’ ë¼ì´íŠ¸ ì¼œê¸°
                    if (!l.gameObject.activeSelf) l.gameObject.SetActive(true);
                    l.enabled = true;
                    l.range = activeRange;
                }
                else
                {
                    // íŠ¸ë¦¬ê±° ë°–ì´ê±°ë‚˜ ë„ˆë¬´ ë¨¼ ë¼ì´íŠ¸ â†’ ë¼ì´íŠ¸ ë„ê¸°
                    if (l.gameObject.activeSelf) l.gameObject.SetActive(false);
                    l.enabled = false;
                    l.range = inactiveRange;
                }
            }
        }
    }
}

